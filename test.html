<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X.com Shenanigans</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="httpshttps://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-start: #1a0f2b;
            --background-end: #0d0d0f;
            --foreground: #e0e0e0;
            --secondary: #a3a3a3;
            --accent-pink: #ff00ff;
            --accent-cyan: #00ffff;
            --accent-green: #00ff9d;
            --scanline-opacity: 0.07;
            --grid-opacity: 0.1;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Roboto Mono', monospace;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: var(--background-end);
            background-image: linear-gradient(to bottom, var(--background-start), var(--background-end));
            color: var(--foreground);
            padding: 40px 20px;
            overflow-x: hidden;
            position: relative;
            font-size: 18px;
        }
        .background-effects {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%; pointer-events: none; z-index: -1;
        }
        .background-effects::after {
            content: " "; display: block; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(0deg, transparent 50%, rgba(0, 0, 0, 0.5) 50%);
            background-size: 100% 4px; animation: scanlines 0.2s linear infinite; opacity: var(--scanline-opacity);
        }
        .background-effects::before {
            content: " "; display: block; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(var(--accent-cyan) 1px, transparent 1px), linear-gradient(90deg, var(--accent-cyan) 1px, transparent 1px);
            background-size: 50px 50px; animation: grid-scroll 10s linear infinite; opacity: var(--grid-opacity);
        }
        @keyframes scanlines { 0% { background-position: 0 0; } 100% { background-position: 0 4px; } }
        @keyframes grid-scroll { 0% { background-position: 0 0; } 100% { background-position: 100px 100px; } }
        
        .container {
            width: 100%; max-width: 800px; padding: 2.5em; 
            background: rgba(13, 13, 15, 0.85); backdrop-filter: blur(10px); z-index: 1;
            text-shadow: 0 0 3px var(--foreground);
            animation: pulse-glitch-glow 4s linear infinite;
        }
        @keyframes pulse-glitch-glow {
            0%, 100% { border: 1px solid var(--accent-pink); box-shadow: 0 0 12px var(--accent-pink), 0 0 15px var(--accent-cyan) inset; }
            25%, 75% { border: 1px solid var(--accent-green); box-shadow: 2px -2px 5px var(--accent-cyan), -2px 2px 5px var(--accent-pink) inset; }
            27%, 77% { border: 1px solid var(--accent-green); box-shadow: -2px 2px 5px var(--accent-cyan), 2px -2px 5px var(--accent-pink) inset; }
            50% { border: 1px solid var(--accent-cyan); box-shadow: 0 0 20px var(--accent-pink), 0 0 25px var(--accent-cyan) inset; }
        }

        h1 {
            font-family: 'Major Mono Display', monospace; color: var(--accent-green); margin: 0 0 1.5em 0;
            text-align: center; text-shadow: 0 0 10px var(--accent-green); font-size: 2.2em;
            position: relative;
        }
        h1::before, h1::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--background-end); overflow: hidden;
        }
        h1::before { left: 2px; text-shadow: -2px 0 var(--accent-pink); animation: glitch-1 2s linear infinite reverse; }
        h1::after { left: -2px; text-shadow: -2px 0 var(--accent-cyan), 2px 2px var(--accent-pink); animation: glitch-2 2s linear infinite reverse; }
        @keyframes glitch-1 { 0%{clip-path:inset(15% 0 86% 0)}2.5%{clip-path:inset(55% 0 2% 0)}5%{clip-path:inset(48% 0 48% 0)}7.5%{clip-path:inset(1% 0 82% 0)}10%{clip-path:inset(91% 0 8% 0)}12.5%{clip-path:inset(46% 0 55% 0)}15%{clip-path:inset(21% 0 78% 0)}17.5%{clip-path:inset(77% 0 1% 0)}20%{clip-path:inset(36% 0 63% 0)}22.5%{clip-path:inset(18% 0 82% 0)}25%{clip-path:inset(4% 0 91% 0)}27.5%{clip-path:inset(81% 0 13% 0)}30%{clip-path:inset(33% 0 64% 0)}32.5%{clip-path:inset(82% 0 1% 0)}35%{clip-path:inset(25% 0 71% 0)}37.5%{clip-path:inset(62% 0 15% 0)}40%{clip-path:inset(39% 0 54% 0)}42.5%{clip-path:inset(93% 0 5% 0)}45%{clip-path:inset(41% 0 54% 0)}47.5%{clip-path:inset(85% 0 6% 0)}50%{clip-path:inset(19% 0 78% 0)}52.5%{clip-path:inset(79% 0 20% 0)}55%{clip-path:inset(38% 0 62% 0)}57.5%{clip-path:inset(97% 0 2% 0)}60%{clip-path:inset(25% 0 71% 0)}62.5%{clip-path:inset(67% 0 31% 0)}65%{clip-path:inset(34% 0 65% 0)}67.5%{clip-path:inset(84% 0 12% 0)}70%{clip-path:inset(23% 0 75% 0)}72.5%{clip-path:inset(65% 0 34% 0)}75%{clip-path:inset(36% 0 62% 0)}77.5%{clip-path:inset(94% 0 1% 0)}80%{clip-path:inset(14% 0 81% 0)}82.5%{clip-path:inset(76% 0 12% 0)}85%{clip-path:inset(38% 0 54% 0)}87.5%{clip-path:inset(97% 0 2% 0)}90%{clip-path:inset(33% 0 60% 0)}92.5%{clip-path:inset(80% 0 11% 0)}95%{clip-path:inset(43% 0 55% 0)}97.5%{clip-path:inset(74% 0 23% 0)}100%{clip-path:inset(45% 0 53% 0)} }
        @keyframes glitch-2 { 0%, 2.9% { clip-path: none; } 3% { clip-path: inset(45% 0 53% 0); } 5% { clip-path: inset(15% 0 86% 0); } 8% { clip-path: none; } }
        
        video { width: 100%; border: 1px solid var(--accent-pink); box-shadow: 0 0 10px var(--accent-pink); }
        .explanation { font-size: 1em; line-height: 1.8; margin: 0 0 1.5em 0; color: var(--secondary); text-align: center; }
        .timers-wrapper { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 2em; }
        .timer-box { flex: 1; padding: 1.5em; border: 1px solid; text-align: center; }
        .timer-box.load { border-color: var(--accent-pink); box-shadow: 0 0 10px var(--accent-pink) inset; }
        .timer-box.visible { border-color: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan) inset; }
        .timer-box.playback { border-color: var(--accent-green); box-shadow: 0 0 10px var(--accent-green) inset; margin-bottom: 2em; }
        .timer-label { font-size: 0.8em; margin-bottom: 0.5em; text-transform: uppercase; color: var(--secondary); letter-spacing: 2px; }
        .timer-display { font-size: 2.8em; font-weight: 700; font-family: 'Major Mono Display', monospace; }
        .timer-description { font-size: 0.9em; color: var(--secondary); margin-top: 1em; }

        .video-controls { background: rgba(0,0,0,0.3); padding: 1em; margin-top: -1em; margin-bottom: 2em; border: 1px solid var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan) inset; }
        .controls-grid { display: flex; align-items: center; gap: 15px; }
        .play-pause-btn { background: transparent; border: 1px solid var(--accent-pink); color: var(--accent-pink); font-size: 1.5em; cursor: pointer; padding: 5px 10px; }
        .progress-bar { flex: 1; height: 10px; background: var(--secondary); cursor: pointer; }
        .progress-bar-filled { height: 100%; width: 0; background: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan); }
        .time-display { font-family: 'Major Mono Display', monospace; font-size: 1.2em; }

        details { border: 1px solid var(--secondary); margin-bottom: 1.5em; }
        details[open] { border-color: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan); }
        summary { padding: 1em; background: rgba(0,0,0,0.3); cursor: pointer; color: var(--accent-cyan); font-weight: 700; outline: none; user-select: none; font-size: 1.1em; }
        summary::before { content: '[+] '; }
        details[open] summary::before { content: '[-] '; }
        .details-content { padding: 1.5em; font-size: 1em; line-height: 1.8; color: var(--secondary); }
        .details-content strong { color: var(--accent-green); }
        .details-content code { background: rgba(0,0,0,0.5); color: var(--accent-pink); padding: 0.2em 0.4em; border-radius: 4px; }

        ul { list-style-type: '>> '; padding-left: 1.2em; color: var(--foreground); font-size: 1em; line-height: 1.8; margin-top: 2em; }
        li { padding-left: 0.5em; margin-bottom: 0.5em; }

        .ip-section { margin-top: 2.5em; border: 1px solid var(--secondary); padding: 1.5em; text-align: center; }
        .ip-section .ip-display { font-family: 'Major Mono Display', monospace; font-size: 2em; color: var(--accent-green); margin-bottom: 0.5em; text-shadow: 0 0 8px var(--accent-green); }
        .ip-section .ip-meta { font-size: 1em; color: var(--secondary); }
        .ip-section .privacy-note { font-size: 0.8em; color: var(--secondary); margin-top: 1.5em; }

        @media (max-width: 768px) {
            body { padding: 20px 10px; font-size: 16px; }
            .timers-wrapper { flex-direction: column; }
            .container { padding: 1.5em; }
            h1 { font-size: 1.8em; }
            .timer-display { font-size: 2.5em; }
            summary { font-size: 1em; }
            .ip-section .ip-display { font-size: 1.5em; }
        }
    </style>
</head>
<body>
    <div class="background-effects"></div>
    <div class="container">
        <h1 data-text="// X.com Shenanigans">// X.com Shenanigans</h1>
        
        <video id="main-video" autoplay muted loop playsinline src="https://travofoz.github.io/hosting/hacker.mp4"></video>
        <div class="video-controls">
            <div class="controls-grid">
                <button class="play-pause-btn" id="play-pause-btn">❚❚</button>
                <div class="progress-bar" id="progress-bar">
                    <div class="progress-bar-filled" id="progress-bar-filled"></div>
                </div>
                <div class="time-display" id="time-display">00:00 / 00:00</div>
            </div>
        </div>

        <p class="explanation">
            This page tests how an app's in-app browser handles web standards. Normally, a browser won't autoplay a video until you can actually see the page. If this video is already playing when the page loads for you, it suggests the app is tricking the browser into thinking you're looking at it before you really are.
        </p>
        
        <div class="timers-wrapper">
            <div class="timer-box load">
                <div class="timer-label">Load/Prerender Time</div>
                <div class="timer-display" id="load-timer">0.00s</div>
                <p class="timer-description">Starts the moment the page begins loading, even if it's in the background.</p>
            </div>
            <div class="timer-box visible">
                <div class="timer-label">Visible Time</div>
                <div class="timer-display" id="visibility-timer">0.00s</div>
                <p class="timer-description">Should only start when you actually see the page on your screen.</p>
            </div>
        </div>
        
        <div class="timer-box playback">
            <div class="timer-label">Total Video Playback Time</div>
            <div class="timer-display" id="total-playback-time">0.00s</div>
            <p class="timer-description">A cumulative timer showing how long the video has actually been playing, even across loops.</p>
        </div>

        <details>
            <summary>Key Concepts: Prefetch, Preload, Prerender</summary>
            <div class="details-content">
                <strong>Prefetching:</strong> A low-priority hint to the browser to download an asset (like a script or image) that a user *might* need for a future navigation. The asset is cached, but no code is executed.<br>
                <strong>Preloading:</strong> A high-priority directive to the browser to download a critical asset for the *current* page. This ensures the resource is available sooner, but again, no code is executed.<br>
                <strong>Prerendering:</strong> The most aggressive technique. The browser loads an entire page in a hidden background tab, including downloading assets, parsing HTML, and <strong>executing JavaScript</strong>. This is what's being tested here.
            </div>
        </details>
        
        <details>
            <summary>Platform Mechanics: How Prerendering Works</summary>
            <div class="details-content">
                <strong>Native Apps (iOS/Android):</strong> Apps use a built-in browser component called a "WebView" (<code>WKWebView</code> on iOS, <code>Android System WebView</code> on Android) to display web content without leaving the app. The app can create a hidden WebView instance and instruct it to load a URL before you click on it. This is prerendering.<br>
                <strong>Desktop Browsers (Chrome):</strong> Modern desktop browsers don't use WebViews. Instead, a website can use the <code>Speculation Rules API</code> to give hints to the browser about which pages a user is likely to visit next, prompting the browser to prerender them.
            </div>
        </details>

        <details>
            <summary>The Visibility Standard</summary>
            <div class="details-content">
                The W3C <code>Page Visibility API</code> is the official standard for determining if a page is visible. A prerendered page must have its <code>document.visibilityState</code> set to <code>'hidden'</code>. This state tells the browser to block resource-intensive or intrusive actions, such as video autoplay, notification requests, or camera access, until the user actually activates the page (making its state <code>'visible'</code>).
            </div>
        </details>

        <details>
            <summary>The Exploit: Faking Visibility</summary>
            <div class="details-content">
                The browser engine inside a WebView determines the <code>visibilityState</code> based on the status of the native view component it lives in. A standard implementation would keep the WebView detached from the main UI, correctly reporting a <code>'hidden'</code> state.<br><br>
                However, a developer can bypass this. By attaching the WebView to the main application's active UI layout but making it imperceptible (e.g., setting its dimensions to <strong>1x1 pixel with 0% opacity</strong>), they trick the browser engine. The engine sees that its native container is technically part of the visible screen layout and incorrectly reports the page's <code>visibilityState</code> as <code>'visible'</code>. This bypasses all standard browser safeguards.
            </div>
        </details>

        <ul>
            <li>Is the WebView being attached to the view hierarchy in a hidden state to incorrectly report its visibility as 'visible'?</li>
            <li>What is the technical justification for bypassing standard visibility behavior, which disables safeguards against background resource usage?</li>
            <li>How does this implementation affect viewability metrics for advertising and internal analytics, and is this disclosed?</li>
            <li><strong>Why is this bad for users?</strong> The timers and video on this page are a simulation of the resource usage (CPU, memory, data) that this bypass enables. The standard exists to prevent this, protecting your device's battery life and performance.</li>
        </ul>

        <div class="ip-section" id="ip-info">
            <p>Fetching IP data...</p>
        </div>
    </div>

    <script>
        document.querySelector('h1').setAttribute('data-text', document.querySelector('h1').textContent);
        
        // Timers Logic
        const loadTimerDisplay = document.getElementById('load-timer');
        const pageLoadTime = Date.now();
        setInterval(() => {
            const elapsedSeconds = (Date.now() - pageLoadTime) / 1000;
            loadTimerDisplay.textContent = `${elapsedSeconds.toFixed(2)}s`;
        }, 50);
        const visibilityTimerDisplay = document.getElementById('visibility-timer');
        let visibilityStartTime = 0;
        let visibilityIntervalId = null;
        function startVisibilityTimer() {
            if (visibilityStartTime === 0) {
                visibilityStartTime = Date.now();
                visibilityIntervalId = setInterval(() => {
                    const elapsedSeconds = (Date.now() - visibilityStartTime) / 1000;
                    visibilityTimerDisplay.textContent = `${elapsedSeconds.toFixed(2)}s`;
                }, 50);
            }
        }
        if (document.visibilityState === 'visible') {
            startVisibilityTimer();
        } else {
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'visible') {
                    startVisibilityTimer();
                }
            }, { once: true });
        }

        // Custom Video Player & Total Playback Logic
        const video = document.getElementById('main-video');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressBarFilled = document.getElementById('progress-bar-filled');
        const timeDisplay = document.getElementById('time-display');
        const totalPlaybackDisplay = document.getElementById('total-playback-time');

        let totalTimePlayed = 0;
        let lastTimeUpdate = performance.now();
        let playbackInterval;

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updatePlaybackTime() {
            const now = performance.now();
            if (!video.paused) {
                const delta = (now - lastTimeUpdate) / 1000; // in seconds
                totalTimePlayed += delta;
                totalPlaybackDisplay.textContent = `${totalTimePlayed.toFixed(2)}s`;
            }
            lastTimeUpdate = now;
        }

        video.addEventListener('play', () => {
            playPauseBtn.textContent = '❚❚';
            lastTimeUpdate = performance.now();
            playbackInterval = setInterval(updatePlaybackTime, 50);
        });

        video.addEventListener('pause', () => {
            playPauseBtn.textContent = '►';
            clearInterval(playbackInterval);
        });

        video.addEventListener('timeupdate', () => {
            const progress = (video.currentTime / video.duration) * 100;
            progressBarFilled.style.width = `${progress}%`;
            timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
        });
        
        video.addEventListener('loadedmetadata', () => {
            timeDisplay.textContent = `00:00 / ${formatTime(video.duration)}`;
        });

        playPauseBtn.addEventListener('click', () => {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        });

        progressBar.addEventListener('click', (e) => {
            const rect = progressBar.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const width = rect.width;
            const percentage = x / width;
            video.currentTime = video.duration * percentage;
        });

        // IP Info Logic
        async function fetchIpInfo() {
            const ipInfoContainer = document.getElementById('ip-info');
            try {
                const response = await fetch('https://ipinfo.io/json');
                if (!response.ok) throw new Error('Response not OK');
                const data = await response.json();
                
                ipInfoContainer.innerHTML = `
                    <p>This request came from IP:</p>
                    <div class="ip-display">${data.ip || 'N/A'}</div>
                    <div class="ip-meta">
                        ${data.city || ''}, ${data.region || ''}, ${data.country || ''}<br>
                        ${data.org || 'ISP Not Found'}
                    </div>
                    <p class="privacy-note">
                        <strong>Disclaimer:</strong> This information was retrieved and displayed by your browser and is not logged by this page. 
                        This site is on GitHub Pages, which may store server logs for security, but that data is not accessible to me. 
                        The IP lookup service is free and may be rate-limited.
                    </p>
                `;
            } catch (error) {
                ipInfoContainer.innerHTML = `
                    <p>Could not fetch IP information.</p>
                    <p class="privacy-note">This can be caused by an ad blocker, a privacy extension, or the lookup service being temporarily unavailable.</p>
                `;
            }
        }
        
        fetchIpInfo();
    </script>
</body>
</html>
